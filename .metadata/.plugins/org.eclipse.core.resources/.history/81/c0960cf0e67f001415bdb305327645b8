package ie.dit.naylor.mark;

import java.io.IOException;

import javax.servlet.http.*;

import com.google.appengine.api.blobstore.BlobKey;
import com.google.appengine.api.blobstore.BlobstoreServiceFactory;
import com.google.appengine.api.datastore.DatastoreService;
import com.google.appengine.api.datastore.DatastoreServiceFactory;
import com.google.appengine.api.datastore.KeyFactory;
import com.google.appengine.repackaged.com.google.api.client.util.Key;

public class DeleteServlet extends HttpServlet {
	/**
	 * 
	 */
	public KeyFactory key;
	private static final long serialVersionUID = 1L;
	private com.google.appengine.api.blobstore.BlobstoreService blobstoreService = BlobstoreServiceFactory.getBlobstoreService();
	DatastoreService datastore = DatastoreServiceFactory.getDatastoreService();
	public void doGet(HttpServletRequest req, HttpServletResponse res) throws IOException 
	{
		BlobKey blobKey = new BlobKey(req.getParameter("blob-key"));
		blobstoreService.delete(blobKey);
		String toDelete = blobKey.getKeyString();
		Key delete = KeyFactory.createKey("key", toDelete);
		datastore.delete(delete);
		res.sendRedirect("/download");
	}

}